# 管理者権限の変更方法

このシステムでは、ユーザーのロール（管理者/面接官）を変更する方法がいくつかあります。

## 方法1: UIから変更（推奨）

### 前提条件
- 既に管理者権限を持つユーザーでログインしていること

### 手順

1. **ユーザー管理ページにアクセス**
   - 左サイドバーの「設定」→「ユーザー管理」をクリック
   - または、`/dashboard/settings/users` に直接アクセス

2. **ユーザー一覧から変更**
   - ユーザー一覧の「アクション」列にある「昇格」または「降格」ボタンをクリック
   - 「昇格」: 面接官 → 管理者
   - 「降格」: 管理者 → 面接官

3. **編集ダイアログから変更**
   - ユーザー一覧の「編集」アイコン（✏️）をクリック
   - ダイアログで「ロール」を選択
   - 「更新」ボタンをクリック

### 注意事項
- **自分自身のロールは変更できません**（セキュリティ上の理由）
- 管理者権限がないと、このページにアクセスできません

---

## 方法2: データベースから直接変更（初回管理者作成時など）

### 前提条件
- Supabaseダッシュボードにアクセスできること
- SQLを実行できること

### 手順

1. **Supabaseダッシュボードにアクセス**
   - https://supabase.com/dashboard にログイン
   - 対象のプロジェクトを選択

2. **SQL Editorを開く**
   - 左サイドバーの「SQL Editor」をクリック

3. **ユーザーを確認**
   ```sql
   SELECT id, clerk_id, name, email, role 
   FROM users 
   ORDER BY created_at;
   ```

4. **特定のユーザーを管理者に変更**
   ```sql
   -- メールアドレスで指定する場合
   UPDATE users 
   SET role = 'admin', updated_at = NOW()
   WHERE email = 'your-email@example.com';
   
   -- または、Clerk IDで指定する場合
   UPDATE users 
   SET role = 'admin', updated_at = NOW()
   WHERE clerk_id = 'user_xxxxxxxxxxxxx';
   ```

5. **変更を確認**
   ```sql
   SELECT id, name, email, role 
   FROM users 
   WHERE email = 'your-email@example.com';
   ```

### 初回管理者の作成

システムを初めて使用する場合、最初のユーザーは自動的に「面接官」として登録されます。最初の管理者を作成するには：

1. **Clerkでユーザーを作成・ログイン**
   - Clerkダッシュボードでユーザーを作成するか、サインアップでユーザーを作成
   - アプリケーションにログイン（これでusersテーブルに自動登録されます）

2. **Supabaseでロールを変更**
   ```sql
   -- 最新のユーザーを管理者に変更
   UPDATE users 
   SET role = 'admin', updated_at = NOW()
   WHERE id = (
     SELECT id FROM users ORDER BY created_at LIMIT 1
   );
   
   -- または、特定のメールアドレスを指定
   UPDATE users 
   SET role = 'admin', updated_at = NOW()
   WHERE email = 'admin@example.com';
   ```

3. **ログアウト・再ログイン**
   - ブラウザからログアウト
   - 再度ログインすると、管理者権限が反映されます

---

## 方法3: APIから直接変更（開発者向け）

### 前提条件
- 管理者権限を持つユーザーの認証トークンが必要

### 手順

1. **認証トークンを取得**
   - ブラウザの開発者ツールで、APIリクエストのAuthorizationヘッダーからトークンを取得

2. **APIリクエストを送信**
   ```bash
   curl -X PATCH "https://your-api-url/api/v1/users/{user_id}" \
     -H "Authorization: Bearer YOUR_TOKEN" \
     -H "Content-Type: application/json" \
     -d '{"role": "admin"}'
   ```

---

## ロールの違い

### 管理者 (Admin)
- ✅ すべての機能へのフルアクセス
- ✅ 企業マスタの管理（作成・編集・削除）
- ✅ 求人ポジションの管理
- ✅ 定性要件マスタの管理
- ✅ エージェントマスタの管理
- ✅ ユーザー管理（ロール変更）
- ✅ すべての候補者・面談ログの閲覧・編集

### 面接官 (Interviewer)
- ✅ 候補者一覧の閲覧
- ✅ 自分が担当する候補者の編集
- ✅ 0.5次面談ログの入力・編集
- ❌ 企業・ポジション・エージェント・定性要件の管理は不可
- ❌ 他のユーザーのロール変更は不可

---

## トラブルシューティング

### Q: ユーザー管理ページにアクセスできない

**原因**: 管理者権限がない

**解決方法**:
1. 既存の管理者に依頼してロールを変更してもらう
2. または、方法2（データベースから直接変更）を使用

### Q: 自分自身のロールを変更したい

**原因**: セキュリティ上の理由で、自分自身のロール変更は禁止されています

**解決方法**:
1. 他の管理者に依頼してロールを変更してもらう
2. または、方法2（データベースから直接変更）を使用

### Q: 初回ログイン時に管理者権限がない

**原因**: 新規ユーザーはデフォルトで「面接官」として登録されます

**解決方法**:
- 方法2（データベースから直接変更）を使用して、最初のユーザーを管理者に変更

---

## セキュリティに関する注意事項

⚠️ **重要**:
- 管理者権限を持つユーザーは、システム全体を制御できます
- 管理者の数を最小限に保つことを推奨します
- 定期的にユーザー一覧を確認し、不要な管理者権限を削除してください
- データベースから直接変更する場合は、必ず変更内容を記録してください

